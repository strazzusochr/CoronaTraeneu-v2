üîç BLACK SCREEN DEBUG-PROTOKOLL
SYSTEMATISCHE FEHLERSUCHE F√úR HUGGINGFACE DEPLOYMENT


AKTUELLER STATUS:

‚úÖ Canvas l√§uft (DebugCube sichtbar)
‚úÖ EngineLoop aktiv (Heartbeats 0.2Hz)
‚úÖ WebGL2 verf√ºgbar
‚ùå Hauptgeometrie UNSICHTBAR (12 Polygone statt 500.000+)
‚ùå StephansplatzWorld nicht gerendert
‚ùå NPCs nicht sichtbar (501 sollten existieren)



1Ô∏è‚É£ SOFORT-DIAGNOSE (5 MINUTEN)
Check 1: Kamera-Position verifizieren
Anweisung:
√ñffne Browser DevTools auf HuggingFace Space. In Console tippe:
window.__three_camera.position
window.__three_camera.rotation
Erwartung:

Position sollte etwa X zwanzig Y zwanzig Z zwanzig sein
Rotation sollte Richtung Zentrum (0, 0, 0) zeigen

Problem-Indikator:
Wenn Kamera Position X null Y null Z null oder sehr weit weg (√ºber 1000) ‚Üí Kamera fehlpositioniert
Fix-Hinweis:
GameCanvas punkt tsx Zeile mit camera equals Objekt pr√ºfen. OrbitControls target pr√ºfen.

Check 2: Scene-Traversierung
Anweisung:
In Console tippe:
let count = 0;
window.__three_scene.traverse(obj => {
  if (obj.type === 'Mesh') {
    console.log(obj.name, obj.position, obj.visible);
    count++;
  }
});
console.log('Total Meshes:', count);
Erwartung:

Mindestens zwanzig Meshes (Boden, Geb√§ude, NPCs)
Alle visible equals true
Positionen im Bereich minus f√ºnfhundert bis plus f√ºnfhundert

Problem-Indikator:

Wenn count kleiner f√ºnf ‚Üí Komponenten werden NICHT instanziiert
Wenn visible equals false f√ºr viele ‚Üí Visibility-Problem
Wenn Positionen alle null null null ‚Üí Transform-Problem


Check 3: Material-Validierung
Anweisung:
In Console tippe:
window.__three_scene.traverse(obj => {
  if (obj.material) {
    console.log(obj.name, {
      type: obj.material.type,
      opacity: obj.material.opacity,
      transparent: obj.material.transparent,
      depthWrite: obj.material.depthWrite
    });
  }
});
Problem-Indikator:

Wenn opacity null oder undefined ‚Üí Material-Initialisierungs-Fehler
Wenn depthWrite false bei opakem Material ‚Üí Rendering-Reihenfolge kaputt
Wenn type undefined ‚Üí Material nicht korrekt erstellt


2Ô∏è‚É£ KOMPONENTEN-ISOLATION (10 MINUTEN)
Test A: StephansplatzWorld isoliert testen
Datei: deploy_hf/src/components/game/GameCanvas.tsx
√Ñnderung Wort-f√ºr-Wort:
Finde die Zeile mit SceneContent Komponente.
Innerhalb der Physics-Komponente kommentiere ALLES aus AUSSER:

DebugCube
StephansplatzWorld

Beispiel-Struktur nach √Ñnderung:
Physics timeStep vary
  DebugCube (bleibt)
  Suspense fallback null
    StephansplatzWorld (bleibt)
    // CityEnvironment (auskommentieren)
    // InstancedCrowd (auskommentieren)
    // WorldStreamingRenderer (auskommentieren)
    // PlayerCharacter (auskommentieren)
  Ende Suspense
Ende Physics
Rebuild:
cd corona-control-ultimate/deploy_hf
npm run build
HuggingFace:
Git commit push. Warte auf Rebuild (circa f√ºnf Minuten).
Erwartung:
Wenn StephansplatzWorld jetzt sichtbar (grauer Boden, Box-Geb√§ude) ‚Üí Problem liegt in ANDEREN Komponenten (CityEnvironment/Streaming blockiert).
Wenn IMMER NOCH nur DebugCube ‚Üí Problem IN StephansplatzWorld selbst.

Test B: Einfachste Geometrie direkt in GameCanvas
Datei: deploy_hf/src/components/game/GameCanvas.tsx
Vor DebugCube einf√ºgen:
Erstelle neue Komponente SimpleGround.
Komponente rendert:
- mesh bei Position null null null
- planeGeometry args hundert hundert
- Rotation X minus neunzig Grad (horizontal)
- meshStandardMaterial color gr√ºn
- receiveShadow true
Code-Struktur in Worten:

Funktions-Komponente SimpleGround ohne Props
Return mesh Element
Position Array null null null
Rotation Array null minus Math punkt PI durch zwei null
planeGeometry mit args Array hundert hundert
meshStandardMaterial mit color Hex null null F F null null
receiveShadow Attribut auf true

Einbindung:
Direkt √ºber DebugCube in SceneContent einf√ºgen.
Rebuild & Deploy.
Erwartung:
Wenn gr√ºne Plane SICHTBAR ‚Üí Basis-Rendering funktioniert, Problem in komplexen Komponenten.
Wenn NICHT sichtbar ‚Üí Fundamentales Rendering-Setup-Problem (Lights? Fog? Camera-Clipping?).

3Ô∏è‚É£ PHYSICS-ISOLATION (5 MINUTEN)
Test C: Ohne Rapier-Physics
Hypothese: Physics-Wrapper blockiert Rendering.
√Ñnderung:
Datei: deploy_hf/src/components/game/GameCanvas.tsx
Entferne Physics-Wrapper komplett.
Struktur VOR √Ñnderung:
Physics timeStep vary
  (alle Komponenten)
Ende Physics
Struktur NACH √Ñnderung:
React Fragment
  (alle Komponenten gleich)
Ende Fragment
Das bedeutet:

L√∂sche √∂ffnende Physics-Zeile
L√∂sche schlie√üende Physics-Zeile
Alles dazwischen bleibt IDENTISCH

Rebuild & Deploy.
Erwartung:
Wenn Geometrie JETZT erscheint ‚Üí Rapier-Physics-Wrapper ist Ursache. Entweder timeStep-Parameter oder Rapier-Init fehlgeschlagen.

4Ô∏è‚É£ LICHT-VALIDIERUNG (3 MINUTEN)
Check 4: Licht-Intensit√§ten pr√ºfen
Problem: Szene komplett schwarz weil keine Lichter oder Intensit√§t null.
Anweisung Console:
window.__three_scene.traverse(obj => {
  if (obj.isLight) {
    console.log({
      type: obj.type,
      intensity: obj.intensity,
      color: obj.color,
      position: obj.position
    });
  }
});
Erwartung:

Mindestens ZWEI Lichter (DirectionalLight + HemisphereLight/AmbientLight)
DirectionalLight Intensit√§t mindestens eins Komma f√ºnf
AmbientLight Intensit√§t mindestens null Komma drei

Problem-Indikator:
Wenn KEINE Lichter gefunden ‚Üí DayNightCycleSystem/DynamicLighting l√§dt nicht.
Notfall-Fix:
F√ºge in GameCanvas direkt vor DebugCube ein:
Erstelle ambientLight Element mit intensity zwei.
Erstelle directionalLight Element:
- position Array f√ºnfzig hundert f√ºnfzig
- intensity zwei
- castShadow true

5Ô∏è‚É£ PROZEDURAL-TEXTUR-TEST (5 MINUTEN)
Check 5: Canvas-basierte Texturen
Hypothese: ProceduralTextures Canvas-API schl√§gt auf HuggingFace fehl (SSR-Umgebung).
Datei: world/WienScene.tsx oder utils/ProceduralTextures.ts
Anweisung:
Suche Funktion die Canvas erstellt (z.B. createAsphaltTexture).
Tempor√§re √Ñnderung:
Ersetze komplette Canvas-Logik durch einfache Farbe.
Statt:
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
// ... komplexe Pixel-Manipulation
const texture = new CanvasTexture(canvas);
Nutze:
Erstelle neue Color aus Three.
Setze Color auf Hex vier vier vier vier vier vier (dunkelgrau).
Return die Color direkt statt Texture.
Oder bei Material:
Statt map gleich texture
Nutze color gleich neue Color Hex acht acht acht acht acht acht
Rebuild & Deploy.
Erwartung:
Wenn Geometrie mit einfarbigem Material ERSCHEINT ‚Üí Canvas-API ist das Problem auf HuggingFace.
Langfristige L√∂sung dann:
Canvas-Texturen pre-rendern als PNG und via public Ordner laden.

6Ô∏è‚É£ FEATURE-FLAG-PR√úFUNG (2 MINUTEN)
Check 6: Phase 14 tats√§chlich aktiv?
Datei: stores/slices/gameSlice.ts
Anweisung Console auf HuggingFace:
window.__gameStore?.getState().gameState.currentPhase
window.__gameStore?.getState().featureFlags
Wenn window doppelunterstrich gameStore nicht existiert:

Gehe zu App.tsx
Suche wo useGameStore definiert ist
F√ºge hinzu: window doppelunterstrich gameStore gleich useGameStore nach Store-Erstellung

Problem-Indikator:
Wenn currentPhase NICHT vierzehn ‚Üí Phase nicht aktiviert.
Schnelltest:
In startGame Funktion nach enablePhase Aufruf f√ºge Log hinzu:
console punkt log 'Phase enabled:', useFeatureFlags punkt getState Klammer auf Klammer zu punkt features);

7Ô∏è‚É£ SUSPENSE-FALLBACK-TEST (5 MINUTEN)
Test D: Ohne Suspense
Hypothese: Suspense h√§lt Komponenten permanent im fallback-Zustand.
Datei: GameCanvas.tsx
√Ñnderung:
Entferne Suspense-Wrapper komplett.
VORHER:
Suspense fallback null
  StephansplatzWorld
  CityEnvironment
  ...
Ende Suspense
NACHHER:
StephansplatzWorld
CityEnvironment
...
Rebuild & Deploy.
Erwartung:
Wenn Komponenten jetzt laden ‚Üí Suspense-Boundary ist Problem (z.B. dynamische Imports schlagen fehl).

8Ô∏è‚É£ INSTANCE-RENDERING-CHECK (3 MINUTEN)
Check 7: InstancedCrowd tats√§chlich aktiv?
Anweisung Console:
window.__three_scene.traverse(obj => {
  if (obj.isInstancedMesh) {
    console.log({
      name: obj.name,
      count: obj.count,
      instanceMatrix: obj.instanceMatrix
    });
  }
});
Erwartung:

count sollte f√ºnfhundert oder mehr sein
instanceMatrix sollte existieren (nicht null)

Problem-Indikator:
Wenn count null oder undefined ‚Üí InstancedMesh wird nicht korrekt erstellt.
Datei: components/characters/InstancedCrowd.tsx
Quick-Fix-Test:
Kommentiere InstancedMesh aus. Ersetze tempor√§r durch EINEN einfachen NPC:
Erstelle mesh bei Position zehn null zehn
cylinderGeometry args null Komma drei null Komma drei eins Komma acht sechzehn
meshStandardMaterial color rot
Wenn dieser EINE NPC sichtbar ‚Üí Instancing-Logik ist Problem.

9Ô∏è‚É£ VIEWPORT/CLIPPING-PROBLEM (2 MINUTEN)
Check 8: Camera Near/Far Planes
Anweisung Console:
console.log({
  near: window.__three_camera.near,
  far: window.__three_camera.far,
  fov: window.__three_camera.fov
});
Problem-Indikator:

near gr√∂√üer eins ‚Üí Nahe Objekte werden geclipt
far kleiner f√ºnfzig ‚Üí Ferne Objekte unsichtbar
fov au√üerhalb zehn bis neunzig ‚Üí Verzerrung/Clipping

Fix-Anweisung:
Datei: GameCanvas.tsx
Bei Canvas camera-Prop:
camera Objekt
  position Array zwanzig zwanzig zwanzig
  fov f√ºnfundvierzig
  near null Komma eins
  far zweitausend
Ende Objekt

üîü FINALE DEBUGGING-STRATEGIE
Wenn ALLE Tests fehlschlagen:
Schritt 1: Minimalstes funktionierendes Beispiel
Erstelle neue Datei: deploy_hf/src/components/test/MinimalScene.tsx
Inhalt in Worten:
Funktions-Komponente MinimalScene.
Return:

mesh Position null zwei null
boxGeometry args f√ºnf f√ºnf f√ºnf
meshStandardMaterial color gelb

In GameCanvas ersetze ALLES in SceneContent durch:
MinimalScene
ambientLight intensity eins
directionalLight position f√ºnfzig hundert f√ºnfzig intensity eins
Wenn gelbe Box SICHTBAR:
‚Üí Problem in komplexen Komponenten, nicht im Setup.
Baue schrittweise auf:

F√ºge Boden hinzu
F√ºge Licht-System hinzu
F√ºge StephansplatzWorld hinzu
F√ºge NPCs hinzu

Bei jedem Schritt: Rebuild, Deploy, Test.

Schritt 2: HuggingFace-spezifische Probleme
CSP-Header √ºberpr√ºfen:
Die Errors zu cdn.jsdelivr.net sind NICHT kritisch (Font-Resolver), ABER:
Falls HuggingFace Content-Security-Policy WebGL blockiert:
Test: √ñffne Space in privatem/Incognito-Fenster.
Fix: F√ºge in index.html Meta-Tag hinzu:
meta http-equiv Content-Security-Policy content default-src selbst unsafe-inline unsafe-eval data colon blob colon

Schritt 3: V6 vs V7 Wechsel
Aktuell l√§uft: V6-App aus deploy_hf Ordner.
Test: Nutze V7-App aus Hauptordner.
√Ñnderung in Dockerfile/README:
Statt:
WORKDIR /app/deploy_hf
Nutze:
WORKDIR /app
Rebuild Space komplett.
Erwartung:
V7 hat mehr Fixes (Loading-Overlay, Feature-Flags). K√∂nnte funktionieren wo V6 scheitert.

‚úÖ ERFOLGS-CHECKLISTE
Test als ERFOLGREICH wenn:

 Polygon-Count √ºber tausend (nicht zw√∂lf)
 Triangles √ºber null Komma f√ºnf K
 Geometries √ºber zehn
 Visuell: Boden sichtbar
 Visuell: Mindestens ein Geb√§ude
 Visuell: Mindestens ein NPC (rot/gr√ºn/gelb)


üéØ WAHRSCHEINLICHSTE URSACHEN (PRIORISIERT)

Kamera au√üerhalb Szene (50% Wahrscheinlichkeit)
‚Üí Check 1 zuerst durchf√ºhren
Licht-System fehlt (30% Wahrscheinlichkeit)
‚Üí Check 4 direkt nach Check 1
Physics-Wrapper blockiert (10% Wahrscheinlichkeit)
‚Üí Test C wenn Check 1+4 OK
ProceduralTextures fehlgeschlagen (5% Wahrscheinlichkeit)
‚Üí Check 5 wenn Geometrie da aber schwarz
Suspense h√§lt Komponenten zur√ºck (5% Wahrscheinlichkeit)
‚Üí Test D als letzter Resort


DIESER LEITFADEN IST SEQUENZIELL. ARBEITE VON OBEN NACH UNTEN. STOPPE BEI ERSTEM ERFOLG.